## Правила игры.

При создании комнаты указываем:

- тему викторины (с языком)
- стоимость входа
- реальный либо виртуальный счет
- конец игры по времени или по достижению результата или по окончанию вопросов
- время или результат (кол-во попаданий)


### Суть.

Появляется вопрос викторины.

Например:

Литература - Золотой теленок.

Назовите Имя Отчество Паниковского из произведения Золотой теленок?

Так же вопрос может быть продублирован на нескольких языках.

Задача участников как можно быстрее ввести правильный ответ на любом, предусмотренном викториной языке, в поле и отправить на сервер.

Кол-во попыток не ограничено.
 
Все выглядит как обычный чат. 
 
Все участники видят вводимые ответы друг друга и могут вводить свои с грамматическими корректировками чужих ответов. 
 
Побеждает тот кто правильно ответил, при этом объявляется победитель и прибавляется счетчик рейтинга и появляется следующий вопрос.
 
В случае не дачи ответов в течении фиксированного промежутка времени появляется подсказка (если есть).

Далее в случае не дачи правильного ответа, он появляется в чатбоксе и викторина продолжается. 

Предусмотреть возможность "вечной викторины", даже при отсутствии участников. 

Вывести ее на главную для участия за счет виртуальных денег.

Кол-во виртуальных денег ограничено ежедневным лимитом который можно поднять за символическую сумму.

Прокачка аккаунта за деньги дает приемущества.

- выкидывать участников без аппрува всеми (только для игры на виртуальные деньги)

- организовывать голосовые и видео чатовые дуплексы с участниками с использованием webRTC




## API Викторина

## Общие положения.

Все запросы унаследовать от глобалного класса для возможности внедрения доп. параметров во все запросы.

### Создание комнаты

#### Запрос

    url: /api/v1/quiz/new
    
    data:
    
        {
            "category": int
        }    
        
category - тематика викторины
        
### Ответ

Универсальный ответ при создании и входе в комнату с информацией о комнате

        {
            "status": 0
            "room_id": int
            "max_time": int
            "cnt_questions": int
            "question": Dict{
                "id": int
                "q": str
                "image": url
                "audio": url
                "video": url
                "answers": Array[
                    md5, md5 ...
                ]
            }
            "category": Dict{
                "name": str
                "id": int
            }
            "players": Array[
                {
                    "id": int
                    "name": str
                    "account": int
                    "rating": int
                }
            ]
        }
        
max_time - время в сек для подсказок (уточнений)   
cnt_questions - кол-во вопросов       
answers - массив md5 хешей от правильных ответов для проверки на стороне клиента    

## Запрос на проверку ответа.

    {
        "action": "check_me"
        "id": int - question id
        "anwer": str
    }
    
Ответ (всем участникам комнаты)

    {
        "action": "new_answer"
        "user": Dict{} - см выше
        "answer": str
        "is_true": bool
        "time": server time
    }    

## Запросы на всех участников, инициирующиеся на стороне сервера при определенных событиях.

### Получение следующего вопроса

        {
            "status": 0
            "room_id": int
            "is_answered": bool - был ли дан правильный ответ на предыдущий вопрос
            "who_won": int(user_id/Null) - кто дал правильный ответ
            "right_answer": str
            "sound": url - звуковое сопровождение
            "effect": str - название эффекта анимации
            "question": Dict{
                "id": int
                "q": str
                "image": url
                "audio": url
                "video": url
                "answers": Array[
                    md5, md5 ...
                ]
        }



## Закрытие комнаты, раздача призов.

    {
        "action": "close_room"
        "room_id": str
        "message": str
    }
    
    
[#Административные запросы.](admin_api.md)


    {
        "game": "название игры", 
        "lobby": "номер лобби на сервере", 
        "question": "текущий вопрос", 
        "correct": "bool",   "players": ["массив информации об участвующих игроках"], "marks": ["массив баллов игроков"]}`

correct - если пользователь ответил возвращает True или False в зависимости от правильности ответа, иначе None

При подключении нового игрока информация о нем добавляется в массив players.

Вопросы, варианты ответов и правильный ответ берем с базы. 

При закрытии лобби, статистику игроков записываем в базу, удаляем лобби с редиса.

При выборе варианта ответа клиент отправляет следующий ответ серверу:

`{"game": "название игры", "lobby": "номер лобби", "answer": "выбранный ответ"}`

При получении ответа от клиента сервер обрабатывает его, проверяет правильность ответа, в случае правильности, сообщает об этом, добавляет его к статистике правильных ответов игрока и отдает новый вопрос, в случае неправильности сообщает об этом и отдает новый вопрос.


Базы для парсинга

https://baza-otvetov.ru
